<!DOCTYPE html>
<html lang="en">
  <head>

  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114915944-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-114915944-1');
</script>



  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Probabilistically interesting planning problems – Laszlo Treszkai</title>
  <meta name="description" content="This post briefly describes the problem of probabilistic planning, and explains what makes a planning problem “probabilistically interesting”.">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:300,400,900,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://treszkai.github.io/2018/probabilistically-interesting">
  <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />


</head>

  <body>
    <main class="u-container" aria-label="Content">
      <div class="c-page">
  <header class="c-page__header">
  
  <h1>Laszlo Treszkai</h1>
  
  <p>
    <a href="/">Posts</a>
    <span class="u-separate"></span>
    <a href="/about/">About me</a>
  </p>
</header>

  <div class="c-page__main">
    <article class="c-article">
  <header class="c-article__header">
    <h1 class="c-article__title">Probabilistically interesting planning problems</h1>
    <p class="c-article__time"><time datetime="2018-05-28T00:00:00+02:00" itemprop="datePublished">May 28, 2018</time></p>
    <!-- Post Tags -->
    </ul>
  </header>
  <div class="c-article__main">
    <p>This post briefly describes the problem of <em>probabilistic planning</em>, and explains in informal terms what makes a planning problem <em>probabilistically interesting</em>, along with some examples.</p>

<h1 id="primer-on-probabilistic-planning">Primer on probabilistic planning</h1>

<p>In a nutshell, planning is about <em>finding a way to win</em>, and as such, the field of research on planners is vast. However, there is no single textbook definition of “planning”, so in this post I’ll try to be as general as possible. One description of a planning problem could be: given a description of an environment, find a sequence of actions that brings the environment from the initial state of the environment to a goal state. There are multiple ways to describe the environment: for example in formal logic with the <a href="https://en.wikipedia.org/wiki/Situation_calculus">situation calculus</a>, or more commonly as a <a href="https://en.wikipedia.org/wiki/Markov_decision_process">Markov decision process (MDP)</a>. In probabilistic planning problems, the functions describing the MDP are not necessarily deterministic: executing action <script type="math/tex">a</script> in state <script type="math/tex">s</script> will bring the environment to state <script type="math/tex">s'</script> with a probability of <script type="math/tex">T(s,a,s')</script>. In contrast with the <em>control problem</em> of reinforcement learning, where the goal is to find an optimal <em>policy</em> (i.e. a mapping from states to actions), in planning one is interested only in a partial policy that brings the agent closer to a goal state, or frequently only a single action that brings the agent closer to a goal state from the current state. An example planning problem is thus: “Siri, show me a way to the library.” Then Siri responds either with a plan that I can follow from the first step to the last (i.e. a route from start to finish), or only an action that I can take right now (“go forward 100 meters”).</p>

<p>Graphical representation of an example MDP:</p>

<p><img src="/files/probabilistically-interesting/MDP-env.jpg" alt="Graphical representation of an example MDP" /></p>

<p>An example policy for the same MDP:</p>

<p><img src="/files/probabilistically-interesting/MDP-policy.jpg" alt="An example policy for the same MDP" /></p>

<p>An example plan for the same MDP:</p>

<p><img src="/files/probabilistically-interesting/MDP-plan.jpg" alt="An example plan for the same MDP" /></p>

<p>The approach taken by a planner differs based on the discounting factor \( \gamma \) and the distribution of rewards. In a <em>shortest path problem</em> the future rewards are discounted (\( 0 &lt; \gamma &lt; 1 \)), and there might be a constant negative reward for every step taken. Together with a positive reward in goal states, an agent with the goal of maximizing return – i.e. the sum of discounted expected future rewards – has incentives to minimize the length of the path to the goal. However, if there is no discounting (\(\gamma = 1 \)) and there’s a positive reward only in the goal states, it is sufficient for the agent to find <em>any</em> way to the goal. (Some call these <em>goal-based problems</em> <a href="#Yoon2008-probabilistic-planning">(Yoon, Fern, Givan, &amp; Kambhampati, 2008)</a>.) In the next section we’ll see that not all plans are created equal, so even in the non-discounted case we want one that ends up in a goal state with the highest probability.</p>

<p>In an <em>offline</em> approach to deterministic planning problems, a planner is given an environment, initial state and goal state, and it needs to return a sequence of actions that brings the environment to the goal state. However, this offline approach does not work for probabilistic problems, where the outcome of an action is not always in our control. Hence a probabilistic planner is usually executed <em>online</em>: it makes an observation (e.g. the current state of the environment, in the fully observable case), does some magic, and outputs a single action that brings the agent closer to a goal state. Nature brings the agent to a new state, not necessarily the one you desired, and these steps are repeated, until you run out of time or end up at a goal.</p>

<p>Since the fourth <a href="http://icaps-conference.org/index.php/Main/Competitions">International Planning Competition</a> in 2004 hosted by the ICAPS (International Conference on Automated Planning and Scheduling), this event featured a probabilistic track. The winner of IPPC 2004 was FF-Replan, a planner that simplifies the probabilistic planning problem into a deterministic one by not considering the multiple potential effects of an action <a href="#Yoon2007-FF-replan">(Yoon, Fern, &amp; Givan, 2007)</a> – hence the title of the paper, “FF-Replan: A Baseline for Probabilistic Planning.”</p>

<h1 id="probabilistically-interesting-planning-problems">Probabilistically interesting planning problems</h1>

<p>Iain Little and Sylvie Thiébaux analyzed the common characteristics of planning problems that can and cannot be optimally solved by a planner like FF-Replan <a href="#Little2007-probabilistic-planning">(Little &amp; Thiébaux, 2007)</a>. They gave necessary and sufficient conditions for a probabilistic planning problem to be <em>probabilistically interesting</em>: on a problem fulfilling these conditions, a planner that determinizes the problem will lose crucial information, and will do worse than a probabilistic planner. In this section I’ll summarize these conditions using natural language, slightly diverging from the vocabulary of the paper. For formal definitions and more examples, see the <a href="http://users.cecs.anu.edu.au/~iain/icaps07.pdf">original paper</a>; it is an interesting read.</p>

<p><em>Criterion 1:</em> there are multiple paths from the start to the goal. If there is only a single path, then any planner that finds <em>a</em> path will do equally good, as this will be the only one.</p>

<p>Counterexample:</p>

<p><img src="/files/probabilistically-interesting/counter-1.png" alt="Graphical description of an MDP with a single goal trajectory" /></p>

<p><em>Criterion 2:</em> where the above two paths diverge, there is a choice about which way to go, i.e. a state \(s_{crossroads}\) from which action \(a_1\) leads to one road with a different probability than action \(a_2\) does. (Yes, this is a sufficient condition for the first criterion.) If it’s only luck that separates the two paths, then the agent doesn’t have much of a choice to do better.</p>

<p>Counterexample:</p>

<p><img src="/files/probabilistically-interesting/counter-2.png" alt="MDP with skill doesn't help" /></p>

<p><em>Criterion 3:</em> there must be a non-trivially avoidable dead end in the environment. A <em>dead end</em> is an absorbing state that is not a goal state, i.e. a state from which there is no path to any goal state. For a dead end to be <em>avoidable</em>, there must be a state \(s_{crossroads}\) with at least two possible actions \(a_{deadly}\) and \(a_{winning}\), such that executing \(a_{deadly}\) brings the agent to the dead end with a higher probability than executing \(a_{winning}\). A dead end is <em>non-trivially avoidable</em> if \(s_{crossroads}\) is on a path from the initial state to a goal state, and there is a non-zero chance of reaching a goal state after executing either \(a_{winning}\) or \(a_{deadly}\).</p>

<p>Counterexample: the probabilistic version of Blocksworld, where the worst case scenario is that a block is dropped accidentally, does not contain dead ends; the environment is irreducible. (This was an actual problem of IPPC 2004.)</p>

<p><img src="/files/probabilistically-interesting/blocksworld.png" alt="Probabilistic Blocks world" /></p>

<p>Counterexample: all dead ends are unavoidable.</p>

<p><img src="/files/probabilistically-interesting/counter-3b.png" alt="MDP with no avoidable dead end" /></p>

<p>Counterexample: all dead ends are trivially avoidable.</p>

<p><img src="/files/probabilistically-interesting/counter-3c.png" alt="MDP with only trivially avoidable dead ends" /></p>

<h1 id="a-simple-yet-interesting-planning-problem">A simple yet “interesting” planning problem</h1>

<p>A very simple problem that is probabilistically interesting is what the authors call <code class="highlighter-rouge">climber</code>, described by the following story:</p>

<blockquote>
  <p>You are stuck on a roof because the ladder you climbed up on fell down. There are plenty of people around; if you call out for help someone will certainly lift the ladder up again. Or you can try to climb down without it. You aren’t a very good climber though, so there is a 40% chance that you will fall and break your neck if you do it alone. What do you do?</p>
</blockquote>

<p>Graphical representation of the <code class="highlighter-rouge">climber</code> problem:
<img src="/files/probabilistically-interesting/climber-orig.jpg" alt="Graphical representation of the climber problem" /></p>

<p>Despite the simplicity of this problem, most methods to turn it into a deterministic problem fail. Little and Thiébaux described 3 ways to determinize a problem, and they called a resulting deteministic problem a “compilation”.</p>

<p>The <em>REPLAN1</em> approach simply drops all but the most likely outcome of every action, and finds the shortest goal trajectory. (This was the approach used by FF-Replan.) Compilation of the climber problem according to REPLAN1:</p>

<p><img src="/files/probabilistically-interesting/climber-det1.jpg" alt="Compilation of the climber problem according to REPLAN1" /></p>

<p><em>REPLAN2(shortest)</em> turns every possible probabilistic outcome of an action into the outcome of a deterministic action, each with a cost of 1. Optimizing for smallest cost thus finds the <em>shortest</em> goal trajectory, but this might not be the one with the highest success probability. Compilation of the climber problem according to REPLAN2(shortest):</p>

<p><img src="/files/probabilistically-interesting/climber-det2.jpg" alt="Compilation of the climber problem according to REPLAN2(shortest)" /></p>

<p><em>REPLAN2(most-likely)</em> also turns every outcome into a separate deterministic action, but the new action costs are the negative log probability of the relevant outcome. This is the only compilation of the problem that finds the optimal path for <code class="highlighter-rouge">climber</code>, but for many other problems even this one will be suboptimal. The resulting compilation is as follows:</p>

<p><img src="/files/probabilistically-interesting/climber-det3.jpg" alt="Compilation of the climber problem according to REPLAN2(most-likely)" /></p>

<h1 id="summary">Summary</h1>

<p>Finding the optimal goal trajectory in a probabilistic planning problem is computationally expensive, so most planners use some heuristics. One way to plan in a stochastic environment is to change the probabilistic planning problem into a deterministic shortest path problem and replan after (almost) every step, which is computationally efficient, but in many cases suboptimal. This article outlined the attributes of probabilistically interesting problems, where the deterministic replanning approach often fails. As such, recent probabilistic planners use more complicated methods (or often a portfolio of probabilistic planners), but replanners remain a good baseline to compare against.</p>

<h1 id="references">References</h1>

<ol class="bibliography"><li><span id="Little2007-probabilistic-planning">Little, I., &amp; Thiébaux, S. (2007). Probabilistic planning vs. replanning. <i>Workshop, ICAPS 2007</i>. Retrieved from http://users.cecs.anu.edu.au/ iain/icaps07.pdf</span></li>
<li><span id="Yoon2007-FF-replan">Yoon, S. W., Fern, A., &amp; Givan, R. (2007). FF-Replan: A Baseline for Probabilistic Planning. In M. S. Boddy, M. Fox, &amp; S. Thiébaux (Eds.), <i>Proceedings of the Seventeenth International Conference on Automated
               Planning and Scheduling, ICAPS 2007, Providence, Rhode Island, USA,
               September 22-26, 2007</i> (p. 352). AAAI. Retrieved from http://www.aaai.org/Library/ICAPS/2007/icaps07-045.php</span></li>
<li><span id="Yoon2008-probabilistic-planning">Yoon, S. W., Fern, A., Givan, R., &amp; Kambhampati, S. (2008). Probabilistic Planning via Determinization in Hindsight. In D. Fox &amp; C. P. Gomes (Eds.), <i>Proceedings of the Twenty-Third AAAI Conference on Artificial Intelligence,
               AAAI 2008, Chicago, Illinois, USA, July 13-17, 2008</i> (pp. 1010–1016). AAAI Press. Retrieved from http://www.aaai.org/Library/AAAI/2008/aaai08-160.php</span></li></ol>

  </div>
  <!-- Previous / Next Buttons -->
  <div class="pagenav">
    
    <div class="wrapper" id="left">
      <small><b>Previous</b> May 23, 2018</small>
      <br>
      <a class="no-hov" href="/2018/youtube-speed">&laquo; Change YouTube speed from your favorites bar</a>
    </div>
    
    
    <div class="wrapper" id="right">
      <small>Jun 9, 2018 <b>Next</b></small>
      <br>
      <a class="no-hov" href="/2018/multilinear-tutorial">IWSGL, Tutorial 3: Multilinear Algebra – Solutions (Exercise 1) &raquo;</a>
    </div>
    
  </div>
  <!-- Disqus comments view -->
  
</article>

  </div>
  <footer class="c-page__footer">
  <p><a href="/LICENSE.html">&copy;</a>  Laszlo Treszkai 2019</p>
  <p>
    <a href="https://twitter.com/ltreszkai">Twitter</a>
    <span class="u-separate"></span><a href="https://github.com/treszkai">GitHub</a>
    <span class="u-separate"></span><a href="mailto:laszlo.treszkai+website@gmail.com">Email</a>
  </p>
</footer>

</div>
<hr>

    </main>
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114915944-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-114915944-1');
</script>


    
  </body>
</html>
